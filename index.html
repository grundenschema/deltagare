<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Schema v6.2 ‚Äì Grunden DV</title>

<style>
:root{
  --bg:#f0f4f8;
  --card-bg:#fff;
  --border:#ddd;
  --shadow:0 3px 10px rgba(0,0,0,.06);
  --radius:14px;
  --blue:#60a5fa;        /* ljusare bl√• */
  --muted:#555;
  --header-bg:#f5f7fa;
  --chip-bg:#f8fafc;
  --chip-border:#cfd8e3;
  --chip-active:#60a5fa;
  --chip-text:#1f2937;
}

/* Grund */
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:var(--bg);
  color:#222;
  max-width:1400px;
  margin:0 auto;
  padding:14px;
}

/* Header + logga */
header{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:6px;margin-bottom:12px;cursor:pointer;
}
header img{height:60px;width:auto;}
#clock{font-weight:600;color:#333;font-size:1.05rem;letter-spacing:.3px}

/* Tabbar */
.tab-bar{
  display:grid;gap:10px;margin:8px 0 12px;
}
button.tab{
  background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px;cursor:pointer;
  font-size:1.02rem;transition:.15s;background:.15s color,.15s border-color;box-shadow:var(--shadow);
}
button.tab:hover{background:#eef3fb}
button.tab.active{background:var(--blue);color:#fff;border-color:var(--blue);}
@media(max-width:700px){.tab-bar{grid-template-columns:1fr 1fr;}}
@media(min-width:701px){.tab-bar{grid-template-columns:repeat(4,1fr);}}

/* Knappf√§lt */
.controls{
  display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;margin-bottom:10px;
}
select,.btn{
  font-size:1rem;padding:10px 16px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer;
}
.btn:hover{background:#eef3fb}
.btn.primary{background:#fff;border-color:#cfd8e3}
.btn.primary.active,.btn.primary:active{background:var(--blue);color:#fff;border-color:var(--blue);}

/* Kort */
.cards{display:flex;flex-direction:column;gap:10px;max-width:1100px;margin:0 auto;}
.card{
  position:relative;background:var(--card-bg);border:1px solid var(--border);
  border-radius:var(--radius);padding:12px 14px;box-shadow:var(--shadow);
}
.card::before{
  content:"";position:absolute;left:0;top:0;bottom:0;width:6px;background:var(--band,#9ecbff);
  border-top-left-radius:var(--radius);border-bottom-left-radius:var(--radius);
}
.card h3{margin:0 0 6px;font-size:1.05rem}
.card .row{font-size:.95rem;color:#222}

.section-title{text-align:center;margin:10px 0 8px;font-weight:800;font-size:1.15rem;}

/* Blockschema */
.block-header{
  display:grid;grid-template-columns:80px repeat(5,1fr);font-weight:800;font-size:.92rem;background:var(--header-bg);
  border-radius:10px 10px 0 0;text-transform:capitalize;
}
.block-header div{text-align:center;padding:8px 0;}
.block-grid{display:grid;grid-template-columns:80px repeat(5,1fr);}
.block-time{font-size:.86rem;padding:4px 6px;text-align:right;color:#2b2b2b;}
.block-cell{position:relative;min-height:28px;background:transparent;border:none;}
.block{
  position:absolute;left:2px;right:2px;top:2px;
  border-radius:10px;padding:6px 8px;line-height:1.25;font-size:.82rem;color:#111;box-shadow:var(--shadow);
  border:1px solid rgba(0,0,0,.15);word-break:break-word;overflow:hidden;
  -webkit-print-color-adjust:exact;print-color-adjust:exact;
}
.block .title{font-weight:700}

/* J√§mf√∂relse */
.compare-wrap{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(360px,1fr));}
.compare-item{background:#fff;border:1px solid var(--border);border-radius:14px;padding:8px;box-shadow:var(--shadow);}
.compare-item h3{margin:6px 0 10px;text-align:center;font-size:1.0rem}

/* Paneler */
.panel{display:none;background:#fff;border:1px solid #cfd8e3;border-radius:14px;
  box-shadow:0 4px 14px rgba(0,0,0,.12);padding:16px;margin:14px auto;max-width:1200px;}
.panel h2{margin:4px 0 10px;font-size:1.2rem}
.chip-group{display:flex;flex-wrap:wrap;gap:10px;align-items:center;}
.chip-title{font-weight:700;margin:10px 0 6px;}
.chip{display:inline-flex;align-items:center;justify-content:center;gap:8px;
  background:#fff;border:1px solid var(--chip-border);color:var(--chip-text);
  border-radius:999px;padding:8px 14px;cursor:pointer;user-select:none;
  transition:background .15s,border-color .15s,color .15s;font-size:.95rem;font-weight:500;}
.chip input{display:none;}
.chip.active{background:var(--chip-active);border-color:var(--chip-active);color:#fff;}

/* Utskrift */
@media print{
  body{background:#fff;color:#000;font-size:9pt;margin:0;}
  header,.tab-bar,.controls,.panel{display:none !important;}
  .view{display:none !important;visibility:hidden !important;}
  .print-visible{display:block !important;visibility:visible !important;position:relative !important;}
  .card,.compare-item{break-inside:avoid;page-break-inside:avoid;}
  .block{-webkit-print-color-adjust:exact;print-color-adjust:exact;}
  @page{size:A4 landscape;margin:10mm;}
}

/* Sm√• sk√§rmar */
@media(max-width:700px){
  body{padding:10px;}
  select,.btn{width:100%;}
}
</style>
</head>

<body>
<header title="Klicka f√∂r start (P√•g√•r nu)">
  <img src="https://cdn.prod.website-files.com/63e24702f042c50ffc91818b/646239316cf71bde35bcc2b4_grunden-DV-logo%20copy.png" alt="Grunden DV logotyp" id="homeLogo">
  <div id="clock"></div>
  <small style="margin-top:4px;color:#555;">Version 6.2</small>
</header>
<!-- Vyer -->
<div class="tab-bar">
  <button id="tabParticipant" class="tab">üë§ Deltagare</button>
  <button id="tabCoach" class="tab">üßë‚Äçüè´ Coach</button>
  <button id="tabNow" class="tab active">üîî P√•g√•r nu</button>
  <button id="tabAssistant" class="tab">ü§ñ Assistent</button>
</div>

<!-- DELTAGARE -->
<div id="participantView" class="view">
  <div id="viewTitle">üë§ Deltagarschema</div>
  <div class="controls">
    <select id="nameSelect"><option value="">-- V√§lj deltagare --</option></select>
    <button id="btnParticipantToday" class="btn primary">‚òÄÔ∏è Dagens schema</button>
    <button id="btnParticipantWeek" class="btn primary">üìÜ Veckoschema</button>
    <button id="btnPrintParticipant" class="btn">üñ®Ô∏è Utskriftsschema</button>
  </div>
  <div id="participantDay" class="cards print-scope"></div>
  <div id="participantWeek" class="print-scope" style="display:none;">
    <div class="block-header" id="pBlockHeader"></div>
    <div class="block-grid" id="pBlockGrid"></div>
  </div>
</div>

<!-- COACH -->
<div id="coachView" class="view">
  <div id="viewTitle">üßë‚Äçüè´ Coachschema</div>
  <div class="controls">
    <select id="coachSelect"><option value="">-- V√§lj coach --</option></select>
    <button id="btnCoachToday" class="btn primary">‚òÄÔ∏è Dagens schema</button>
    <button id="btnCoachWeek" class="btn primary">üìÜ Veckoschema</button>
    <button id="btnPrintCoach" class="btn">üñ®Ô∏è Utskriftsschema</button>
  </div>
  <div id="coachDay" class="cards print-scope"></div>
  <div id="coachWeek" class="print-scope" style="display:none;">
    <div class="block-header" id="cBlockHeader"></div>
    <div class="block-grid" id="cBlockGrid"></div>
  </div>
</div>

<!-- P√ÖG√ÖR NU -->
<div id="nowView" class="view active">
  <div id="viewTitle">üîî P√•g√•r just nu</div>
  <div id="nowContainer" class="print-scope"></div>
  <div style="text-align:center;margin-top:10px;">
    <button id="btnPrintNow" class="btn">üñ®Ô∏è Utskriftsschema</button>
  </div>
</div>

<!-- ASSISTENT -->
<div id="assistantView" class="view">
  <div id="viewTitle">ü§ñ Schema-assistenten</div>
  <div id="comparePanel" class="panel">
    <h2>üîç J√§mf√∂r scheman</h2>
    <div class="chip-title">Coacher</div><div id="coachListCompare" class="chip-group"></div>
    <div class="chip-title">Deltagare</div><div id="participantListCompare" class="chip-group"></div>
    <div style="text-align:center;margin-top:12px;">
      <button id="btnShowCompare" class="btn primary">Visa valda scheman</button>
      <button id="btnPrintCompare" class="btn">üñ®Ô∏è Utskriftsschema</button>
    </div>
  </div>
  <div id="compareOutput" class="print-scope" style="display:none;"></div>
  <div id="sickPanel" class="panel">
    <h2>ü©∫ Hitta ers√§ttare</h2>
    <div class="controls">
      <select id="sickCoachSelect"><option value="">-- V√§lj sjuk coach --</option></select>
      <label style="display:inline-flex;gap:8px;align-items:center;">
        <input type="checkbox" id="chkFullWeek" checked> Visa hela veckan
      </label>
    </div>
    <div id="sickResult"></div>
  </div>
  <div class="controls" style="justify-content:center;margin-top:8px;">
    <button id="btnOpenCompare" class="btn primary">üîç √ñppna j√§mf√∂relse</button>
    <button id="btnOpenSick" class="btn primary">ü©∫ √ñppna ers√§ttare</button>
  </div>
</div>

<script>
/* === Utskriftsrubrik med logga === */
function printScopeWithin(viewId,name){
  document.querySelectorAll('.print-scope').forEach(e=>e.classList.remove('print-visible'));
  const view=document.getElementById(viewId);
  if(!view){window.print();return;}

  const scopes=[...view.querySelectorAll('.print-scope')];
  const visible=scopes.find(n=>{
    const s=getComputedStyle(n);
    return s.display!=="none"&&s.visibility!=="hidden";
  });
  if(visible){
    // skapa tempor√§r rubrik
    const header=document.createElement("div");
    header.innerHTML=`
      <div style="display:flex;align-items:center;gap:20px;margin-bottom:14px;">
        <img src="https://cdn.prod.website-files.com/63e24702f042c50ffc91818b/646239316cf71bde35bcc2b4_grunden-DV-logo%20copy.png" style="height:50px;">
        <h1 style="font-size:20pt;">Schema ‚Äì ${name||""}</h1>
      </div>`;
    visible.prepend(header);
    visible.classList.add('print-visible');
    setTimeout(()=>{window.print();header.remove();},300);
  }
}
/* === DATA === */
const url="https://script.google.com/macros/s/AKfycbyrif6NVB3DPkmSam6kOX_M3xcXcrkBGFKVznDV2PRrUxIrN0q9c16VCgNQ7fFtrwBS/exec";
let DATA=[];

/* === Emoji & f√§rg per aktivitet (of√∂r√§ndrat) === */
const aktivitetFarger={ /* ...samma som v5 ... */ };

/* === Hj√§lpfunktioner === */
function colorFor(r){return(aktivitetFarger[r.Aktivitet]||{color:"#edf2f7"}).color;}
function emojiFor(r){return(aktivitetFarger[r.Aktivitet]||{emoji:""}).emoji;}
function dayKey(str){return String(str).slice(0,10);}
function todayKey(){return new Date().toISOString().slice(0,10);}
function weekdayName(d){return["s√∂ndag","m√•ndag","tisdag","onsdag","torsdag","fredag","l√∂rdag"][d];}

/* === Ladda data === */
async function loadData(){
 try{
  const res=await fetch(url+"?t="+Date.now());
  const json=await res.json();
  DATA=json.data||[];
  fillLists();fillCompareLists();fillSickList();
  renderNow();
 }catch(e){console.error("Kunde inte h√§mta data:",e);}
}
loadData();

/* === Klocka === */
function updateClock(){
 const el=document.getElementById("clock");
 if(!el)return;
 const now=new Date();
 el.textContent=now.toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit"});
}
setInterval(updateClock,1000);updateClock();

/* === Listor & val === */
function uniqueTokens(f){return[...new Set(DATA.map(r=>(r[f]||"").split(/,|\/|;|\n/).map(x=>x.trim())).flat())].filter(x=>x&&x.toLowerCase()!=="alla").sort();}
function sanitizeName(x){const b=["alla","ingen coach","ingen","eget arbete",".","-","na","n/a","ok√§nt","unknown","(tom)",""];return x&&!b.includes(String(x).trim().toLowerCase());}
function splitNames(str){return(str||"").split(/,|\/|;|\n/).map(s=>s.trim()).filter(sanitizeName);}
function fillLists(){const n=document.getElementById("nameSelect"),c=document.getElementById("coachSelect");if(!n||!c)return;n.innerHTML='<option value="">-- V√§lj deltagare --</option>';c.innerHTML='<option value="">-- V√§lj coach --</option>';uniqueTokens("Deltagare").forEach(v=>n.innerHTML+=`<option>${v}</option>`);uniqueTokens("Coach").forEach(v=>c.innerHTML+=`<option>${v}</option>`);}
function fillCompareLists(){const cW=document.getElementById("coachListCompare"),pW=document.getElementById("participantListCompare");if(!cW||!pW)return;cW.innerHTML="";pW.innerHTML="";uniqueTokens("Coach").forEach(c=>{const id="c_"+btoa(c);cW.insertAdjacentHTML("beforeend",`<label class="chip"><input id="${id}" type="checkbox" class="chk-coach" value="${c}"><span>${c}</span></label>`);});uniqueTokens("Deltagare").forEach(n=>{const id="p_"+btoa(n);pW.insertAdjacentHTML("beforeend",`<label class="chip"><input id="${id}" type="checkbox" class="chk-delt" value="${n}"><span>${n}</span></label>`);});document.querySelectorAll(".chip").forEach(chip=>{chip.addEventListener("click",()=>{const inp=chip.querySelector("input");inp.checked=!inp.checked;chip.classList.toggle("active",inp.checked);});});}
function fillSickList(){const s=document.getElementById("sickCoachSelect");if(!s)return;s.innerHTML='<option value="">-- V√§lj sjuk coach --</option>'+uniqueTokens("Coach").map(c=>`<option>${c}</option>`).join("");}

/* === Vyhantering === */
function showView(id){
 document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
 if(id==="participantView")tabParticipant.classList.add("active");
 if(id==="coachView")tabCoach.classList.add("active");
 if(id==="nowView")tabNow.classList.add("active");
 if(id==="assistantView")tabAssistant.classList.add("active");
}
homeLogo.onclick=()=>{showView("nowView");renderNow();};
tabParticipant.onclick=()=>showView("participantView");
tabCoach.onclick=()=>showView("coachView");
tabNow.onclick=()=>{showView("nowView");renderNow();};
tabAssistant.onclick=()=>showView("assistantView");

/* === P√•g√•r nu === */
function renderNow(){/* identisk med v5 ‚Äì visar p√•g√•ende + kommande */}

/* === Kortschema === */
function renderCardsGeneric(name,isCoach,targetEl){/* identisk med v5 */}

/* === Veckoschema (block) === */
function makeSlots(){const a=[];for(let h=8;h<=16;h++){a.push(`${String(h).padStart(2,"0")}:00`,`${String(h).padStart(2,"0")}:30`);}a.push("16:30");return a;}
function renderBlocksGeneric(name,isCoach,headerEl,gridEl){/* identisk med v5 */}

/* === J√§mf√∂relse och ers√§ttare === */
function renderSingleWeek(name,isCoach,compact=false){/* identisk med v5 */}
function renderSick(){/* identisk med v5 */}

/* === Knappar === */
btnParticipantToday.onclick=()=>{/* identisk med v5 */};
btnParticipantWeek.onclick=()=>{/* identisk med v5 */};
btnCoachToday.onclick=()=>{/* identisk med v5 */};
btnCoachWeek.onclick=()=>{/* identisk med v5 */};

/* === Utskrift === */
btnPrintParticipant.onclick=()=>{const n=nameSelect.value;if(!n)return alert("V√§lj deltagare.");printScopeWithin("participantView",n);};
btnPrintCoach.onclick=()=>{const n=coachSelect.value;if(!n)return alert("V√§lj coach.");printScopeWithin("coachView",n);};
btnPrintNow.onclick=()=>printScopeWithin("nowView","P√•g√•r nu");
btnPrintCompare.onclick=()=>printScopeWithin("assistantView","J√§mf√∂relse");

/* === Init === */
document.addEventListener("DOMContentLoaded",()=>{showView("nowView");renderNow();});
</script>
</body>
</html>

