<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Schema v5 ‚Äì Grunden DV</title>

<style>
:root {
  --bg:#f0f4f8;
  --card-bg:#fff;
  --border:#ddd;
  --shadow:0 3px 10px rgba(0,0,0,.06);
  --radius:14px;
  --blue:#3b82f6;
  --muted:#555;
  --header-bg:#f5f7fa;
  --chip-bg:#f8fafc;
  --chip-border:#cfd8e3;
  --chip-active:#3b82f6;
  --chip-text:#1f2937;
}

/* Reset & bas */
* { box-sizing:border-box; margin:0; padding:0; }
body {
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:var(--bg);
  color:#222;
  max-width:1400px;
  margin:0 auto;
  padding:14px;
}

/* Header (loggan = hemknapp) */
header {
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:6px;
  margin-bottom:12px;
  cursor:pointer;
}
header img { height:60px; width:auto; }
#clock { font-weight:600; color:#333; font-size:1.05rem; letter-spacing:.3px; }

/* Tabbar */
.tab-bar {
  display:grid;
  gap:10px;
  margin:8px 0 12px;
}
button.tab {
  background:#fff;
  border:1px solid var(--border);
  border-radius:12px;
  padding:12px;
  cursor:pointer;
  font-size:1.02rem;
  transition:.15s background,.15s color,.15s border-color;
  box-shadow:var(--shadow);
}
button.tab:hover { background:#eef3fb; }
button.tab.active { background:var(--blue); color:#fff; border-color:var(--blue); }
@media (max-width:700px){ .tab-bar{ grid-template-columns:1fr 1fr; } }
@media (min-width:701px){ .tab-bar{ grid-template-columns:repeat(4,1fr); } }

/* Controls */
.controls {
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  justify-content:center;
  align-items:center;
  margin-bottom:10px;
}
select, .btn {
  font-size:1rem;
  padding:10px 16px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#fff;
  cursor:pointer;
}
.btn:hover { background:#eef3fb; }
.btn.primary.active, .btn.primary:active {
  background:var(--blue);
  color:#fff;
  border-color:var(--blue);
}

/* Cards */
.cards {
  display:flex;
  flex-direction:column;
  gap:10px;
  max-width:1100px;
  margin:0 auto;
}
.card {
  position:relative;
  background:var(--card-bg);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:12px 14px;
  box-shadow:var(--shadow);
}
.card::before {
  content:"";
  position:absolute;
  left:0; top:0; bottom:0;
  width:6px;
  background:var(--band,#9ecbff);
  border-top-left-radius:var(--radius);
  border-bottom-left-radius:var(--radius);
}
.card h3 { margin:0 0 6px; font-size:1.05rem; }

/* Veckoschema */
#blockContainer { display:none; margin-top:8px; }
.block-header {
  display:grid;
  grid-template-columns:80px repeat(5,1fr);
  font-weight:800;
  font-size:.92rem;
  background:var(--header-bg);
  border-radius:10px 10px 0 0;
  text-transform:capitalize;
}
.block-header div { text-align:center; padding:8px 0; }
.block-grid {
  display:grid;
  grid-template-columns:80px repeat(5,1fr);
  grid-auto-rows:24px; /* varje halvtimme */
}
.block-time {
  font-size:.86rem;
  padding:4px 6px;
  text-align:right;
  color:#2b2b2b;
}
.block-cell { position:relative; background:transparent; }

/* Block */
.block {
  position:absolute;
  left:2px; right:2px; top:2px;
  border-radius:10px;
  padding:6px 8px;
  line-height:1.25;
  font-size:.82rem;
  color:#111;
  box-shadow:var(--shadow);
  border:1px solid rgba(0,0,0,.15);
  word-break:break-word;
  overflow:visible;
  -webkit-print-color-adjust:exact;
  print-color-adjust:exact;
}

/* Print ‚Äì A4 liggande, korrekt skala */
@media print {
  header, .tab-bar, button.btn, .controls { display:none !important; }
  .view { display:none !important; }
  .view.active { display:block !important; overflow:visible !important; }

  body {
    background:#fff !important;
    color:#000 !important;
    font-size:9pt;
    margin:0;
    padding:0;
    width:100%;
    transform:scale(0.95);
    transform-origin:top left;
    -webkit-print-color-adjust:exact;
    print-color-adjust:exact;
  }

  .print-header {
    text-align:center;
    font-size:12pt;
    margin-bottom:4mm;
  }

  .cards, .block-grid, .compare-wrap {
    max-width:none !important;
    width:100% !important;
  }

  .block {
    overflow:visible !important;
    font-size:0.75rem !important;
    line-height:1.1 !important;
    padding:3px 5px !important;
  }

  .block-grid {
    grid-auto-rows:18px !important; /* varje rad = 30 min */
  }

  .block-time {
    font-size:0.65rem !important;
    padding:1px 4px !important;
  }

  @page {
    size:A4 landscape;
    margin:6mm;
  }
}
</style>
</head>
<body>

<header title="Klicka f√∂r start (P√•g√•r nu)">
  <img src="https://cdn.prod.website-files.com/63e24702f042c50ffc91818b/646239316cf71bde35bcc2b4_grunden-DV-logo%20copy.png"
       alt="Grunden DV logotyp" id="homeLogo">
  <div id="clock"></div>
</header>

<!-- Flikar -->
<div class="tab-bar">
  <button id="tabParticipant" class="tab">üë§ Deltagare</button>
  <button id="tabCoach" class="tab">üßë‚Äçüè´ Coach</button>
  <button id="tabNow" class="tab active">üîî P√•g√•r nu</button>
  <button id="tabAssistant" class="tab">ü§ñ Assistent</button>
</div>

<!-- DELTAGARE -->
<div id="participantView" class="view">
  <div id="viewTitle">üë§ Deltagarschema</div>
  <div class="controls">
    <select id="nameSelect"><option value="">-- V√§lj deltagare --</option></select>
    <button id="btnParticipantToday" class="btn primary">‚òÄÔ∏è Dagens schema</button>
    <button id="btnParticipantWeek" class="btn primary">üìÜ Veckoschema</button>
    <button id="btnPrintParticipant" class="btn">üñ®Ô∏è Skriv ut</button>
  </div>
  <div id="participantDay" class="cards print-scope"></div>
  <div id="participantWeek" class="print-scope" style="display:none;">
    <div class="block-header" id="pBlockHeader"></div>
    <div class="block-grid" id="pBlockGrid"></div>
  </div>
</div>

<!-- COACH -->
<div id="coachView" class="view">
  <div id="viewTitle">üßë‚Äçüè´ Coachschema</div>
  <div class="controls">
    <select id="coachSelect"><option value="">-- V√§lj coach --</option></select>
    <button id="btnCoachToday" class="btn primary">‚òÄÔ∏è Dagens schema</button>
    <button id="btnCoachWeek" class="btn primary">üìÜ Veckoschema</button>
    <button id="btnPrintCoach" class="btn">üñ®Ô∏è Skriv ut</button>
  </div>
  <div id="coachDay" class="cards print-scope"></div>
  <div id="coachWeek" class="print-scope" style="display:none;">
    <div class="block-header" id="cBlockHeader"></div>
    <div class="block-grid" id="cBlockGrid"></div>
  </div>
</div>

<!-- P√ÖG√ÖR NU -->
<div id="nowView" class="view active">
  <div id="viewTitle">üîî P√•g√•r just nu</div>
  <div id="nowContainer" class="print-scope"></div>
  <div style="text-align:center;margin-top:10px;">
    <button id="btnPrintNow" class="btn">üñ®Ô∏è Skriv ut</button>
  </div>
</div>

<!-- ASSISTENT -->
<div id="assistantView" class="view">
  <div id="viewTitle">ü§ñ Schema-assistenten</div>
  <div id="comparePanel" class="panel">
    <h2>üîç J√§mf√∂r scheman</h2>
    <div class="chip-title">Coacher</div>
    <div id="coachListCompare" class="chip-group"></div>
    <div class="chip-title">Deltagare</div>
    <div id="participantListCompare" class="chip-group"></div>
    <div style="text-align:center;margin-top:12px;">
      <button id="btnShowCompare" class="btn primary">Visa valda scheman</button>
      <button id="btnPrintCompare" class="btn">üñ®Ô∏è Skriv ut</button>
    </div>
  </div>
  <div id="compareOutput" class="print-scope" style="display:none;"></div>
</div>

<script>
/* === Utskriftsrubrik === */
function preparePrintHeader(titleText, personName) {
  document.querySelector(".print-header")?.remove();
  const hdr = document.createElement("div");
  hdr.className = "print-header";
  const datum = new Date().toLocaleDateString("sv-SE", { year: "numeric", month: "long", day: "numeric" });
  hdr.innerHTML = `<h2>Schema ‚Äì ${personName || titleText || "Ok√§nd"} ‚Äì ${datum}</h2>`;
  document.body.prepend(hdr);
}

/* === Utskriftshantering === */
function printSchema(title, personName) {
  preparePrintHeader(title, personName);
  const activeView = document.querySelector(".view.active");
  if (activeView) activeView.classList.add("print-visible");
  setTimeout(() => window.print(), 300);
  setTimeout(() => {
    document.querySelectorAll(".print-visible").forEach(el => el.classList.remove("print-visible"));
    document.querySelector(".print-header")?.remove();
  }, 1500);
}

/* === Blockrendering med korrekt h√∂jd === */
function makeSlots() {
  const a=[];
  for(let h=8;h<=16;h++){
    a.push(`${String(h).padStart(2,"0")}:00`,`${String(h).padStart(2,"0")}:30`);
  }
  a.push("16:30");
  return a;
}
function renderBlocksGeneric(name,isCoach,headerEl,gridEl){
  const slots=makeSlots();
  const days=["m√•ndag","tisdag","onsdag","torsdag","fredag"];
  const field=isCoach?"Coach":"Deltagare";
  const rows=DATA.filter(r=>{
    const list=splitNames(r[field]||"");
    return (list.map(x=>x.toLowerCase()).includes(name.toLowerCase())) || (r[field]||"").trim().toLowerCase()==="alla";
  });
  headerEl.innerHTML="<div>Tid</div>"+days.map(d=>`<div>${d}</div>`).join("");
  gridEl.innerHTML="";
  gridEl.style.gridTemplateColumns=`80px repeat(${days.length},1fr)`;
  slots.forEach(t=>{
    gridEl.innerHTML+=`<div class='block-time'>${t}</div>`+days.map(()=>`<div class='block-cell'></div>`).join("");
  });
  const cells=[...gridEl.children];
  rows.forEach(r=>{
    const d=new Date(r.Datum);
    let wd=d.getDay(); if(wd===0||wd===6) return;
    const col=(wd-1)+1;
    const sIdx=slots.indexOf(r.Start), eIdx=slots.indexOf(r.Slut);
    if(sIdx<0||eIdx<=sIdx) return;
    const firstCellIndex=sIdx*(1+days.length)+col;
    const firstCell=cells[firstCellIndex];
    const block=document.createElement("div");
    block.className="block";
    block.style.background=colorFor(r);
    const [sh,sm]=(r.Start||"00:00").split(":").map(Number);
    const [eh,em]=(r.Slut||"00:00").split(":").map(Number);
    const duration=(eh*60+em)-(sh*60+sm);
    block.innerHTML=`${emojiFor(r)} ${r.Aktivitet||""}<br>${isCoach?"üë• "+(r.Deltagare||"-"):"üßë‚Äçüè´ "+(r.Coach||"-")}`;
    requestAnimationFrame(()=>{
      const rowH=18;
      const cellsPerSlot=1;
      const total=(duration/30)*rowH*cellsPerSlot;
      block.style.height=total+"px";
    });
    firstCell.appendChild(block);
  });
}

/* === Aktivera utskrift === */
window.addEventListener("load",()=>{
  const buttons={
    btnPrintParticipant:"Deltagarschema",
    btnPrintCoach:"Coachschema",
    btnPrintNow:"P√•g√•r nu",
    btnPrintCompare:"J√§mf√∂relse"
  };
  Object.entries(buttons).forEach(([id,title])=>{
    const el=document.getElementById(id);
    if(el){
      el.addEventListener("click",()=>{
        let personName="";
        const activeView=document.querySelector(".view.active");
        if(activeView?.id==="participantView") personName=document.getElementById("nameSelect")?.value||"";
        else if(activeView?.id==="coachView") personName=document.getElementById("coachSelect")?.value||"";
        printSchema(title,personName);
      });
    }
  });
});
</script>
</body>
</html>
<script>
/* =========================
   Utskriftsrubrik
========================= */
function preparePrintHeader(titleText, personName) {
  document.querySelector(".print-header")?.remove();
  const hdr = document.createElement("div");
  hdr.className = "print-header";
  const datum = new Date().toLocaleDateString("sv-SE", {
    year: "numeric",
    month: "long",
    day: "numeric"
  });
  hdr.innerHTML = `<h2>Schema ‚Äì ${personName || titleText || "Ok√§nd"} ‚Äì ${datum}</h2>`;
  document.body.prepend(hdr);
}

/* =========================
   Utskriftsfunktion
========================= */
function printSchema(title, personName) {
  preparePrintHeader(title, personName);
  const activeView = document.querySelector(".view.active");
  if (activeView) activeView.classList.add("print-visible");
  setTimeout(() => window.print(), 300);
  setTimeout(() => {
    document.querySelectorAll(".print-visible").forEach(el => el.classList.remove("print-visible"));
    document.querySelector(".print-header")?.remove();
  }, 1500);
}

/* =========================
   Blockrendering (f√∂r utskrift & vy)
========================= */
function makeSlots() {
  const a = [];
  for (let h = 8; h <= 16; h++) {
    a.push(`${String(h).padStart(2, "0")}:00`, `${String(h).padStart(2, "0")}:30`);
  }
  a.push("16:30");
  return a;
}

function renderBlocksGeneric(name, isCoach, headerEl, gridEl) {
  const slots = makeSlots();
  const days = ["m√•ndag", "tisdag", "onsdag", "torsdag", "fredag"];
  const field = isCoach ? "Coach" : "Deltagare";
  const rows = DATA.filter(r => {
    const list = splitNames(r[field] || "");
    return (list.map(x => x.toLowerCase()).includes(name.toLowerCase())) ||
      (r[field] || "").trim().toLowerCase() === "alla";
  });

  // Rubriker
  headerEl.innerHTML = "<div>Tid</div>" + days.map(d => `<div>${d}</div>`).join("");
  gridEl.innerHTML = "";
  gridEl.style.gridTemplateColumns = `80px repeat(${days.length},1fr)`;

  // Tidsrader
  slots.forEach(t => {
    gridEl.innerHTML += `<div class='block-time'>${t}</div>` +
      days.map(() => `<div class='block-cell'></div>`).join("");
  });

  const cells = [...gridEl.children];

  // Fyll block
  rows.forEach(r => {
    const d = new Date(r.Datum);
    let wd = d.getDay();
    if (wd === 0 || wd === 6) return;
    const col = (wd - 1) + 1;
    const sIdx = slots.indexOf(r.Start),
      eIdx = slots.indexOf(r.Slut);
    if (sIdx < 0 || eIdx <= sIdx) return;

    const firstCellIndex = sIdx * (1 + days.length) + col;
    const firstCell = cells[firstCellIndex];
    const block = document.createElement("div");
    block.className = "block";
    block.style.background = colorFor(r);

    const [sh, sm] = (r.Start || "00:00").split(":").map(Number);
    const [eh, em] = (r.Slut || "00:00").split(":").map(Number);
    const duration = (eh * 60 + em) - (sh * 60 + sm);

    // Textinneh√•ll
    block.innerHTML = `${emojiFor(r)} ${r.Aktivitet || ""}<br>${isCoach ? "üë• " + (r.Deltagare || "-") : "üßë‚Äçüè´ " + (r.Coach || "-")}`;

    // Blockh√∂jd
    requestAnimationFrame(() => {
      const rowH = 24; // matchar .block-grid radh√∂jd (30 min)
      const total = (duration / 30) * rowH;
      block.style.height = total + "px";
    });

    firstCell.appendChild(block);
  });
}

/* =========================
   Aktivera utskrift p√• knappar
========================= */
window.addEventListener("load", () => {
  const buttons = {
    btnPrintParticipant: "Deltagarschema",
    btnPrintCoach: "Coachschema",
    btnPrintNow: "P√•g√•r nu",
    btnPrintCompare: "J√§mf√∂relse"
  };

  Object.entries(buttons).forEach(([id, title]) => {
    const el = document.getElementById(id);
    if (el) {
      el.addEventListener("click", () => {
        let personName = "";
        const activeView = document.querySelector(".view.active");
        if (activeView?.id === "participantView")
          personName = document.getElementById("nameSelect")?.value || "";
        else if (activeView?.id === "coachView")
          personName = document.getElementById("coachSelect")?.value || "";
        printSchema(title, personName);
      });
    }
  });
});
</script>
</body>
</html>
