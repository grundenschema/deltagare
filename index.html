<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Deltagarschema ‚Äì Grunden DV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f7faff;
      color: #222;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 { color: #003366; margin-bottom: 10px; }
    .name-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 20px; }
    button {
      background: #e9f3ff;
      border: 1px solid #bcd4ff;
      border-radius: 10px;
      padding: 10px 14px;
      font-size: 1.1rem;
      cursor: pointer;
    }
    button:hover { background: #d4e9ff; }
    .activity {
      background: #fff;
      border-left: 10px solid #9ecbff;
      border-radius: 12px;
      margin: 10px auto;
      padding: 10px;
      max-width: 600px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: left;
    }
    .activity h3 { margin: 0; font-size: 1.2rem; }
    .activity .time { font-weight: bold; }
    .day-heading {
      background: #eef5ff;
      border-radius: 8px;
      padding: 6px 10px;
      font-weight: bold;
      margin: 20px auto 10px;
      max-width: 600px;
      text-align: left;
    }
    #backBtn {
      display: none;
      margin: 20px auto;
      padding: 10px 20px;
      border: none;
      background: #003366;
      color: white;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
    }
    #backBtn:hover { background: #001f44; }
  </style>
</head>
<body>
  <h1>Deltagarschema</h1>
  <div id="nameView">
    <p>V√§lj deltagare:</p>
    <div id="nameList" class="name-list">Laddar...</div>
  </div>

  <div id="scheduleView" style="display:none;">
    <h2 id="personTitle"></h2>
    <div id="schedule"></div>
    <button id="backBtn">‚¨ÖÔ∏è Tillbaka</button>
  </div>

  <script>
    const url = "https://script.google.com/macros/s/AKfycbyrif6NVB3DPkmSam6kOX_M3xcXcrkBGFKVznDV2PRrUxIrN0q9c16VCgNQ7fFtrwBS/exec";

    const aktivitetFarger = {
      "M√•ndagsm√∂te":{color:"#AED6F1",emoji:"üìÖ"}, "Gruppm√∂te":{color:"#7FB3D5",emoji:"üë•"},
      "Lunch":{color:"#F9E79F",emoji:"üç≤"}, "Frukost":{color:"#FAD7A0",emoji:"ü•ê"},
      "Atelj√©":{color:"#F5CBA7",emoji:"üé®"}, "Musik":{color:"#D2B4DE",emoji:"üé∂"},
      "Pod":{color:"#A9CCE3",emoji:"üéôÔ∏è"}, "Padel":{color:"#82E0AA",emoji:"üèì"},
      "Lite av varje":{color:"#FADBD8",emoji:"‚ú®"}, "Yoga":{color:"#D5F5E3",emoji:"üßò"},
      "Gym":{color:"#A3E4D7",emoji:"üèãÔ∏è‚Äç‚ôÇÔ∏è"}, "Film":{color:"#E6B0AA",emoji:"üé¨"},
      "F√∂reningsgruppen":{color:"#D6DBDF",emoji:"ü§ù"}, "Trummor":{color:"#F1948A",emoji:"ü•Å"},
      "√Öterkoppling":{color:"#85C1E9",emoji:"üîÑ"}, "Medicin":{color:"#E59866",emoji:"üíä"},
      "Biljard":{color:"#A9DFBF",emoji:"üé±"}, "Spelgruppen":{color:"#F8C471",emoji:"üé≤"},
      "S√∂mnad":{color:"#F5EEF8",emoji:"üßµ"}, "Filmgruppen":{color:"#E6B0AA",emoji:"üé¨"},
      "Musikquizz":{color:"#D2B4DE",emoji:"üé∂"}, "Musikdokument√§r":{color:"#D2B4DE",emoji:"üé∂"}
    };

    let DATA = [];

    async function loadData() {
      const res = await fetch(url + "?t=" + Date.now());
      const json = await res.json();
      DATA = json.data || [];
      buildNameList();
    }

    function parseList(str) {
      return (str || "").split(/,|\/|;|\n| och /i).map(s => s.trim()).filter(Boolean);
    }

    function buildNameList() {
      const names = [...new Set(DATA.flatMap(r => parseList(r.Deltagare)))].filter(n => n.toLowerCase() !== "alla").sort();
      document.getElementById("nameList").innerHTML =
        names.map(n => `<button onclick="showSchedule('${n}')">${n}</button>`).join("");
    }

    function showSchedule(namn) {
      document.getElementById("nameView").style.display = "none";
      document.getElementById("scheduleView").style.display = "block";
      document.getElementById("personTitle").textContent = namn;

      const rows = DATA.filter(r => {
        const deltagare = (r.Deltagare || "").toLowerCase();
        return deltagare.includes(namn.toLowerCase()) || deltagare === "alla";
      }).sort((a,b)=>a.Datum.localeCompare(b.Datum) || (a.Start||"").localeCompare(b.Start||""));

      const byDay = {};
      rows.forEach(r => {
        (byDay[r.Datum] = byDay[r.Datum] || []).push(r);
      });

      let html = "";
      for (const d of Object.keys(byDay).sort()) {
        const label = new Date(d).toLocaleDateString("sv-SE",{weekday:"long",day:"numeric",month:"long"});
        html += `<div class="day-heading">${label}</div>`;
        byDay[d].forEach(r => {
          const akt = aktivitetFarger[r.Aktivitet] || {color:"#fff",emoji:""};
          html += `
            <div class="activity" style="border-left-color:${akt.color}">
              <div class="time">${r.Start || ""}‚Äì${r.Slut || ""}</div>
              <h3>${akt.emoji} ${r.Aktivitet || "Aktivitet"}</h3>
              <div>Coach: ${r.Coach || "-"}</div>
            </div>
          `;
        });
      }
      document.getElementById("schedule").innerHTML = html || "<p>Inget schema hittades.</p>";
    }

    document.getElementById("backBtn").onclick = () => {
      document.getElementById("nameView").style.display = "block";
      document.getElementById("scheduleView").style.display = "none";
    };

    loadData();
  </script>
</body>
</html>
